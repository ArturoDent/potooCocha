"use strict";function onResizeWindow(){initCurrentMap(),window.innerWidth<870?window.addEventListener("scroll",checkWindowScroll):window.removeEventListener("scroll",checkWindowScroll);var e=document.querySelector("#mapsCollection"),t=e.children.length;t>0&&(window.innerWidth>1680?e.style.height="350px":window.innerWidth>=1600?e.style.height="300px":window.innerWidth>=1165?e.style.height="270px":e.style.height="235px")}function checkWindowScroll(){var e=document.documentElement,t=window;e.scrollHeight-t.innerHeight<=t.pageYOffset?document.getElementById("currentMap").style.opacity=0:document.getElementById("currentMap").style.opacity=1}function initCurrentMap(){prepareSVGstyles("SAMsvg"),map||(map=document.getElementById("currentMap")),map.style.opacity="1"}function showCountryModal(e){document.querySelector("#countryModal").classList.add("md-show"),map.classList.add("modal-shrink"),countryModalOpener="checklistCountryButton"===e.target.id?"checklistCountryButton":"taxonomyCountryButton"}function closeCountryModal(){document.querySelector("#countryModal").classList.remove("md-show"),map.classList.remove("modal-shrink")}function toggleSampleTableShowEndemics(){sampleTable.querySelector("td.endemical").classList.toggle("showEndemics")}function toggleSampleTableSciNames(){sampleTable.classList.toggle("noScientificNames"),italics.disabled=!italics.disabled}function toggleSampleTableItalics(){sampleTable.classList.toggle("noItalics")}function toggleSampleTableLeftChecks(){[].forEach.call(sampleTable.getElementsByClassName("leftCheckBox"),function(e){e.classList.toggle("show")}),[].forEach.call(sampleTable.getElementsByClassName("familyHidden"),function(e){e.classList.toggle("show")})}function toggleSampleTableLineNumbers(){sampleTable.querySelector("td.lineNumbers").classList.toggle("showLineNumbers")}function choseCountry(e){"checklistCountryButton"===countryModalOpener?choseChecklistCountry(e):loadCountryTaxonomy(e)}function choseChecklistCountry(e){var t=document.body.scrollTop;closeCountryModal();var a=e.target.innerHTML;currentChecklistCountry&&(currentChecklistCountryElement.classList.remove("checkHighlight"),currentChecklistCountryElement.classList.remove("bothHighlights")),currentChecklistCountry="South America"===a?"SouthAmerica":"French Guiana"===a?"FrenchGuiana":"Falklands/Malv."===a?"Falklands":"Curaçao"===a?"Curacao":a,checklistCountryButton.innerHTML=a,"Falklands/Malv."===a&&(checklistCountryButton.innerHTML="Falklands"),currentChecklistCountryElement=e.target,currentChecklistCountryElement.classList.add("checkHighlight"),currentChecklistCountryElement.classList.contains("taxHighlight")&&currentChecklistCountryElement.classList.add("bothHighlights"),checklistCountryButton.classList.remove("needsAttention"),checklistCountryButton.classList.add("highlight"),pdfButton.classList.add("highlight"),csvButton.classList.add("highlight"),document.body.scrollTop=t,currentMap.querySelector(".saveMapButton").style.display="none",currentMap.querySelector(".colorKey").style.opacity="0",selectedCountryFillColor(currentChecklistCountry,selectedFillColor),getAjax("Authors/"+currentChecklistCountry+".txt",setChecklistAuthors)}function setChecklistAuthors(e){if("SouthAmerica"===currentChecklistCountry)return checklistAuthorsPanel.innerHTML="<a href='citations.html' target='_blank'>citations</a>",void checklistAuthorsPanel.classList.add("show");var t=e.replace(/^(.*\.) \d\d\d\d\..*Version(.*$)/g,"$1 $2");checklistAuthorsPanel.innerHTML=t,checklistAuthorsPanel.classList.add("show")}function setNumDays(e){var t=e.target;t.classList.contains("highlight")||((gNumDays||0===gNumDays)&&numDaysButton.children[gNumDays+1].classList.remove("highlight"),t.classList.add("highlight"),gNumDays=parseInt(t.innerHTML),sampleTable.classList.remove(previousNumDaysClass),sampleTable.classList.add("numDays"+String(gNumDays)),previousNumDaysClass="numDays"+String(gNumDays),[].forEach.call(sampleTable.querySelectorAll("td:nth-child(6)"),function(e){e.classList.remove("cds")}),sampleTable.querySelector("th:nth-child(4)").classList.remove("cds"),[].forEach.call(sampleTable.querySelectorAll("td:nth-child(8)"),function(e){e.classList.remove("cds")}),sampleTable.querySelector("th:nth-child(6)").classList.remove("cds"),6===gNumDays||7===gNumDays?([].forEach.call(sampleTable.querySelectorAll("td:nth-child(6)"),function(e){e.classList.add("cds")}),sampleTable.querySelector("th:nth-child(4)").classList.add("cds")):10===gNumDays?([].forEach.call(sampleTable.querySelectorAll("td:nth-child(13)"),function(e){e.classList.remove("cds")}),sampleTable.querySelector("th:nth-child(11)").classList.remove("cds"),[].forEach.call(sampleTable.querySelectorAll("td:nth-child(8)"),function(e){e.classList.add("cds")}),sampleTable.querySelector("th:nth-child(6)").classList.add("cds")):5!==gNumDays&&([].forEach.call(sampleTable.querySelectorAll("td:nth-child(8)"),function(e){e.classList.add("cds")}),sampleTable.querySelector("th:nth-child(6)").classList.add("cds"),[].forEach.call(sampleTable.querySelectorAll("td:nth-child(13)"),function(e){e.classList.add("cds")}),sampleTable.querySelector("th:nth-child(11)").classList.add("cds")),0!==gNumDays&&([].forEach.call(sampleTable.getElementsByTagName("th"),function(e){e.classList.remove("flashDays")}),sampleTable.querySelector("th:nth-child("+(gNumDays+1)+")").classList.add("flashDays")))}function getCSVText(){if(currentChecklistCountry){var e=document.createElement("form");e.setAttribute("method","post"),e.setAttribute("action","../php/sendCSV.php?country="+currentChecklistCountry),document.body.appendChild(e),e.submit(),e.remove()}else checklistCountryButton.classList.add("needsAttention")}function openChecklistPage(){var e;return currentChecklistCountry?(void 0===gNumDays&&(gNumDays=12),void 0===gStartDate&&(gStartDate=1),e="?country="+currentChecklistCountry,e+="&num_days="+gNumDays,e+="&start_date="+gStartDate,e+="&line_nos="+lineNumbers.checked,e+="&left_check="+leftCheck.checked,e+="&endemics="+showEndemics.checked,e+="&sci_names="+!sciNames.checked,e+="&italics="+!italics.checked,void window.open("../php/makePDF.php"+e,"_blank")):(checklistCountryButton.innerHTML="Select Country",void checklistCountryButton.classList.add("needsAttention"))}function prepareSVGstyles(e){var t;t=e.target&&"SAMsvg"===e.target.id?document.getElementById("SAMsvg"):document.getElementById(e);var a=t.contentDocument;for(var s in countries){var n=a.getElementById(s);n&&setSVGstyles(n,baseColor,baseStrokeColor)}}function setSVGstyles(e){if("path"===e.nodeName)e.style.transition="fill 1s";else if("g"===e.parentNode.nodeName)for(var t=e.querySelectorAll("path"),a=t.length,s=0;s<a;s++)t[s].style.transition="fill 1s"}function fillSAMmap(e){e||(e=baseColor);var t;t=currentMap.querySelector("#SAMsvg");var a=t.contentDocument;for(var s in countries){var n=a.getElementById(s);n&&newFillColor(n,e)}addBirdNameToMap("")}function newFillColor(e,t){if("path"===e.nodeName)t===baseColor&&(e.style.fill="#757570"),e.style.fill=t;else if("g"===e.parentNode.nodeName)for(var a=e.querySelectorAll("path"),s=a.length,n=0;n<s;n++)t===baseColor&&(a[n].style.fill="#757570"),a[n].style.fill=t}function selectedCountryFillColor(e,t){var a=currentMap.querySelector("#SAMsvg"),s=a.contentDocument,n=s.getElementById(e);n?(fillSAMmap(),newFillColor(n,t)):fillSAMmap()}function highlightSAMmap(e,t){var a;a="currentMap"===t?currentMap.querySelector("#SAMsvg"):document.getElementById(t);var s=a.contentDocument,n=birds[e].split("-");for(var l in countries){var r=s.getElementById(l);if(r)switch(n[countries[l]]){case"X(e)":newFillColor(r,endemicColor);break;case"X":newFillColor(r,residentColor);break;case"NB":newFillColor(r,nonBreederColor);break;case"V":newFillColor(r,vagrantColor);break;case"H":newFillColor(r,hypotheticalColor);break;case"IN":newFillColor(r,introducedColor);break;case"EX":newFillColor(r,extinctColor);break;case"EX(e)":newFillColor(r,extinctColor);break;default:newFillColor(r,baseColor)}}"currentMap"===t&&mapsCollection.children.length<5&&(saveMapButton.style.display="block")}function loadIntoArray(e){birds=e.split("\n")}function animateScrollTop(e){var t=25;!function a(){e.scrollTop-=t,e.scrollTop>0&&setTimeout(a,25)}()}function getAjax(e,t){var a=new XMLHttpRequest;return a.open("GET",e),a.onreadystatechange=function(){a.readyState>3&&200===a.status&&t(a.responseText)},a.setRequestHeader("X-Requested-With","XMLHttpRequest"),a.send(),a}function showSearchInstructions(e){e!==!0&&searchInstructionsOpen?(searchSlideUpWrapper.style.height=0,searchSlideUpWrapper.classList.add("closeInstructions"),searchInstructionsOpen=!1,document.querySelector(".taxInstructionsButton .tooltip").innerHTML="Open the search instructions"):(searchSlideUpWrapper.style.height=searchSlideUpWrapper_height,searchSlideUpWrapper.classList.remove("closeInstructions"),searchInstructionsOpen=!0,document.querySelector(".taxInstructionsButton .tooltip").innerHTML="Close the search instructions")}function createTaxPageHTML(){resultsFrag="<div class='panel results-panel'>",resultsFrag+="  <div id='countrySearch' class='closed'>",resultsFrag+="    <span id='searchTerm'></span>",resultsFrag+="  </div>",resultsFrag+="  <ul id='searchResults' contenteditable='false'><li> &nbsp; &nbsp; search results will appear here...</li><li></li><li></li></ul>",resultsFrag+="</div>",taxFragHTML="<article id='taxTreeArticle'>",taxFragHTML+="  <div id='treeIntroText' class='flyoutPanel topFlyoutPanel'>&nbsp; numFamilies Families, numSpecies species</div>",taxFragHTML+="  <div id='taxPage' class='panel' contenteditable='false'></div>",taxFragHTML+="  <div id='taxPageButtons' class='flyoutPanel bottomFlyoutPanel'>Close all families</div>",taxFragHTML+="</article>"}function loadCountryTaxonomy(e){window.closeCountryModal(),document.getElementById("taxPage")||(taxonomyArticle.insertAdjacentHTML("beforeend",resultsFrag),mapsCollection.insertAdjacentHTML("afterend",taxFragHTML),taxPage=document.getElementById("taxPage"),searchResults=document.getElementById("searchResults"),taxPage.addEventListener("click",toggleFamilyOpen),searchResults.addEventListener("click",gotoMatch),document.querySelector("#searchForm span.grayed").classList.remove("grayed"),searchSpecials.classList.remove("grayed"),taxPage.style.webkitTransform="scale(1)",searchResults.style.webkitTransform="scale(1)",taxPage.WebkitTransform="rotateZ(0deg)",taxPage.style.zIndex=5,taxPage.style.display="none",taxPage.offsetHeight,taxPage.style.display="block");var t="string"==typeof e?e:e.target.innerHTML;if(currentTaxonomyCountry&&(currentTaxonomyCountryElement.classList.remove("taxHighlight"),currentTaxonomyCountryElement.classList.remove("bothHighlights")),lastQuery&&(document.getElementById("countrySearch").classList.remove("closed"),document.getElementById("searchTerm").innerHTML=t+" : '"+lastQuery+"'",document.querySelector(".results-panel").style.opacity="1"),"French Guiana"===t?(getAjax("Countries/FrenchGuianaSACC.html",updatetaxArticleQueries),searchResults.classList.remove("samTax"),taxPage.classList.remove("samTax")):"Curaçao"===t?(getAjax("Countries/CuracaoSACC.html",updatetaxArticleQueries),searchResults.classList.remove("samTax"),taxPage.classList.remove("samTax")):"South America"===t?(getAjax("Countries/SouthAmericaSACC.html",updatetaxArticleQueries),searchResults.classList.add("samTax"),searchSpecials.querySelector("span:nth-of-type(3)").classList.add("notAvailable"),searchSpecials.querySelector("span:nth-of-type(5)").classList.add("notAvailable"),searchSpecials.classList.add("SAM"),taxPage.classList.add("samTax")):"Falklands/Malv."===t?(getAjax("Countries/FalklandsSACC.html",updatetaxArticleQueries),searchResults.classList.remove("samTax"),taxPage.classList.remove("samTax"),t="Falklands"):t&&(getAjax("Countries/"+t+"SACC.html",updatetaxArticleQueries),searchResults.classList.remove("samTax"),taxPage.classList.remove("samTax")),"South America"===currentTaxonomyCountry&&"South America"!==t&&(searchSpecials.querySelector("span:nth-of-type(3)").classList.remove("notAvailable"),searchSpecials.querySelector("span:nth-of-type(5)").classList.remove("notAvailable"),searchSpecials.classList.remove("SAM")),lastQuery)"endemic"!==lastQuery&&"hypothetical"!==lastQuery&&"vagrant"!==lastQuery&&"incertae"!==lastQuery&&"extinct"!==lastQuery||(currentMap.querySelector(".saveMapButton").style.display="none",selectedCountryFillColor(t.replace(" ",""),selectedFillColor));else{currentMap.querySelector(".saveMapButton").style.display="none";var a=t.replace(" ","");selectedCountryFillColor(a,selectedFillColor)}currentTaxonomyCountry=t,taxonomyCountryButton.innerHTML=t,"Falklands"===t&&(taxonomyCountryButton.innerHTML="Malvinas"),currentTaxonomyCountryElement=e.target,currentTaxonomyCountryElement.classList.add("taxHighlight"),currentTaxonomyCountryElement.classList.contains("checkHighlight")&&currentTaxonomyCountryElement.classList.add("bothHighlights"),taxonomyCountryButton.classList.remove("needsAttention"),taxonomyCountryButton.classList.add("highlight"),document.querySelector("#treeIntroText").innerHTML=t+" &nbsp; : &nbsp; "+numFamiliesList[t]+" families, "+numSpeciesList[t]+" species *","Falklands"===t&&(document.querySelector("#treeIntroText").innerHTML="Falklands/Malvinas &nbsp; : &nbsp; "+numFamiliesList[t]+" families, "+numSpeciesList[t]+" species *"),document.querySelector(".colorKey").style.opacity="0.9",animateScrollTop(taxPage)}function updatetaxArticleQueries(e){taxPage.innerHTML=e,species=document.getElementById("tree").getElementsByTagName("li"),families=taxPage.querySelectorAll("#tree .familyOpen, #tree .family"),numFamilies=families.length,lastQuery&&searchTree(lastQuery),document.querySelector("#taxPageButtons").addEventListener("click",closeAllFamilies)}function clearSearchInput(){searchInput.placeholder="",searchInput.removeEventListener("input",clearSearchInput),searchInput.removeEventListener("change",clearSearchInput),searchInput.removeEventListener("click",clearSearchInput),searchInput.removeEventListener("textInput",clearSearchInput),searchInput.removeEventListener("focusin",clearSearchInput)}function getQuery(e){var t=searchInput.value.search(/[^a-zñã'\s\*\?-]/i);if(t!==-1)return searchResults.innerHTML="<li></li><li> &nbsp; &nbsp; character '"+searchInput.value[t]+"' not allowed </li><li></li>",void(searchResults.style.height="55px");if(!(searchInput.value.length<2)){var a=e||window.event;return"textinput"===a.type?(searchTree(searchInput.value),a.preventDefault(),!1):void("input"===a.type?searchTree(searchInput.value):"onpropertychange"===a.type&&searchTree(searchInput.value))}}function getSearchSpecialsQuery(e){var t=e.target.textContent.split(" ")[0];searchTree(t)}function escapeRegExp(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function searchTree(e){var t;e=escapeRegExp(e),document.querySelector(".colorKey").style.opacity="0.9";var a=0,s=new MutationObserver(function(){searchResults.style.height="auto",searchResults.scrollHeight>=300?searchResults.style.height="315px":searchResults.style.height=searchResults.scrollHeight+15+"px"});if(s.observe(searchResults,{childList:!0}),!currentTaxonomyCountry)return void taxonomyCountryButton.classList.add("needsAttention");if(document.getElementById("searchResults").classList.remove("fadeIn"),document.querySelector(".results-panel").style.opacity="1",lastQuery=e,!lastQuery)return searchResults.innerHTML="<li></li><li> &nbsp; &nbsp; search results will appear here</li><li></li>",searchResults.classList.add("fadeIn"),void(searchResults.style.top=0);document.getElementById("countrySearch").classList.remove("closed"),"Falklands"===currentTaxonomyCountry?document.getElementById("searchTerm").innerHTML="Falklands/Malvinas : '"+lastQuery+"'":document.getElementById("searchTerm").innerHTML=currentTaxonomyCountry+" : '"+lastQuery+"'",animateScrollTop(searchResults);for(var n=0;n<numFamilies;n++)families[n].cloned=!1;var l=!1;lastSpecies&&lastSpecies.classList.contains("active")&&lastSpecies.classList.remove("active");var r,c,i=[],o=0,u=species.length;if("endemic"===e||"hypothetical"===e||"vagrant"===e||"incertae"===e||"extinct"===e){var d;"endemic"===e?d=document.getElementById("tree").getElementsByClassName("endemic"):"extinct"===e?d=document.getElementById("tree").getElementsByClassName("extinct"):"hypothetical"===e?d=document.getElementById("tree").getElementsByClassName("hy"):"vagrant"===e?d=document.getElementById("tree").getElementsByClassName("va"):"incertae"===e&&(d=document.getElementById("tree").getElementsByClassName("ince"));for(var m=0;m<d.length;m++)d[m].parentNode.parentNode.parentNode.cloned!==!0&&(i[o++]=d[m].parentNode.parentNode.parentNode.cloneNode(!0),d[m].parentNode.parentNode.parentNode.cloned=!0),i[o++]=d[m].parentNode.cloneNode(!0)}else{if(e=e.replace(/^\s+|\s+$/g,""),e=e.replace(/\\\*/g,"[a-zA-Z'ñã\\s-]+"),e=e.replace(/\\\?/g,"[a-zA-Z'ñã\\s-]"),e=e.replace(/n/g,"(n|ñ)"),e=e.replace(/a/g,"(a|ã)"),e=e.replace(/ú/g,"u"),e=e.replace(/á/g,"a"),e=e.replace(/ó/g,"o"),e=e.replace(/í/g,"i"),e=e.replace(/ç/g,"c"),e=e.replace(/\s+/g,"\\s+"),e?t=e:(t=searchInput.value.replace(/^\s+|\s+$/g,""),"type here"===t?l=!0:""===t&&(l=!0)),l)return searchResults.innerHTML="<li></li><li> &nbsp; &nbsp; no search term entered</li><li></li>",document.getElementById("searchResults").classList.add("fadeIn"),void(searchResults.style.height="55px");var h=new RegExp(t,"i");for(n=0;n<u;n++)if(r=species[n],c=r.className,r.firstChild.textContent.match(h)||r.childNodes[1].textContent.match(h)){"family"!==c&&"familyOpen"!==c||(r.cloned=!0);var p=r.parentNode.parentNode;"family"!==c&&"familyOpen"!==c&&p.cloned!==!0&&(i[o++]=p.cloneNode(!0),p.cloned=!0),i[o++]=r.cloneNode(!0)}}if(0===i.length)return searchResults.innerHTML="<li></li><li> &nbsp; &nbsp; no matching results found</li><li></li>",document.getElementById("searchResults").classList.add("fadeIn"),void(searchResults.style.height="55px");var y,g,C="";for(m=0;m<i.length;m++)if(g=i[m].className,"family"===g||"familyOpen"===g){if(C+="<li class='family'><span class='fco'>",C+=i[m].firstChild.textContent+"</span><span class='fsc'>",C+=i[m].childNodes[1].firstChild?i[m].childNodes[1].firstChild.nodeValue:" ",C+="</span></li>",1===i.length){for(y=0;y<i[0].children[2].children.length;y++)C+="<li>"+i[0].children[2].children[y].innerHTML+"</li>";a=y}}else"fsc"===g||(i[m].style.textShadow="none",C+="<li data-i='"+i[m].getAttribute("data-i")+"' class='bird'>"+i[m].innerHTML+"</li>",a++);searchResults.innerHTML=C,document.getElementById("searchResults").classList.add("fadeIn"),lastQuery=lastQuery.replace(/\\\*/g,"*"),lastQuery=lastQuery.replace(/\\\?/g,"?"),"Falklands"===currentTaxonomyCountry?document.getElementById("searchTerm").innerHTML="Malvinas/Falklands : '"+lastQuery+"'&nbsp;&nbsp;&nbsp;   [ "+a+" species ]":document.getElementById("searchTerm").innerHTML=currentTaxonomyCountry+" : '"+lastQuery+"'&nbsp;&nbsp;&nbsp;   [ "+a+" species ]"}function gotoMatch(e){currentMap.querySelector(".colorKey").style.opacity="0.9",lastSpecies&&lastSpecies.classList.contains("active")&&lastSpecies.classList.remove("active");var t=e||window.event,a=t.target,s=a.parentNode,n=a.className;if("no matching results found"!==a.textContent.replace(/^\s+|\s+$/g,"")&&"no search term entered"!==a.textContent.replace(/^\s+|\s+$/g,"")&&"search results will appear here"!==a.textContent.replace(/^\s+|\s+$/g,"")&&""!==a.textContent.replace(/^\s+|\s+$/g,"")){a="family"===n?t.target:"fco"===n?s:"fsc"===n?s:null!==n.match(/co/)?s:"bird"===n?t.target:s;for(var l,r=species.length,c=a.textContent,i=0;i<r;i++){if(l=species[i],l.textContent===c){var o=l.parentNode;o.classList.contains("open")||(o.classList.add("open"),o.parentNode.className="familyOpen"),taxPage.scrollTop=o.parentNode.offsetTop+l.offsetTop-100,l.className="active",lastSpecies=l,lastIndex=Number(l.getAttribute("data-i")),highlightSAMmap(lastIndex,"currentMap"),lastResultsSpecies&&lastResultsSpecies.classList.toggle("active"),a.classList.toggle("active"),lastResultsSpecies=a,addBirdNameToMap(l);break}if(l.firstChild.textContent+l.firstChild.nextSibling.textContent===c||c===l.firstChild.textContent+" "){var u=l.children[2];u.classList.contains("closed")&&(u.classList.add("open"),u.parentNode.className="familyOpen"),taxPage.scrollTop=l.offsetTop,lastSpecies=u,lastResultsSpecies&&(lastResultsSpecies.classList.toggle("active"),lastResultsSpecies=null);break}}}}function addBirdNameToMap(e){var t="";e?(t="<span>"+e.firstChild.textContent+"</span><br/><span>"+e.lastChild.textContent+"</span>",document.getElementById("currentBirdName").innerHTML=t):document.getElementById("currentBirdName").innerHTML=t}function toggleFamilyOpen(e){if(e.stopPropagation(),numFamilies){document.querySelector(".colorKey").style.opacity="0.9",e=e||window.event;var t,a=e.target,s=a.className;if("family"===s||"familyOpen"===s?t=e.target.firstChild.nextSibling.nextSibling.nextSibling:"fco"===s?t=e.target.nextSibling.nextSibling.nextSibling:"fsc"===s&&(t=e.target.nextSibling.nextSibling),t&&!t.classList.contains("open")){t.classList.add("open"),t.parentNode.className="familyOpen";var n=taxPage.getBoundingClientRect().height;t.offsetTop-taxPage.scrollTop>n-24&&(t.parentNode.clientHeight>n?taxPage.scrollTop=t.parentNode.offsetTop:taxPage.scrollTop+=t.lastElementChild.offsetTop+t.lastElementChild.clientHeight),document.querySelector("#treeIntroText").innerHTML=currentTaxonomyCountry+"  &nbsp; : &nbsp; "+t.parentNode.children[1].textContent+" has "+t.children.length+" species"}else if(t){t.classList.remove("open"),t.parentNode.className="family";var l=t.parentNode.querySelectorAll(".active");l.length&&(l[0].className=""),document.querySelector("#treeIntroText").innerHTML=currentTaxonomyCountry+"   &nbsp; : &nbsp; "+numFamiliesList[currentTaxonomyCountry]+" families, "+numSpeciesList[currentTaxonomyCountry]+" species"}t||(a.parentNode.classList.contains("birds")&&(a=a.firstChild),a.parentNode.className="active",a.parentNode!==lastSpecies&&lastSpecies&&lastSpecies.classList.contains("active")&&lastSpecies.classList.remove("active"),lastSpecies=a.parentNode,lastResultsSpecies&&lastResultsSpecies.classList.toggle("active"),lastResultsSpecies=null,addBirdNameToMap(a.parentNode),lastIndex=Number(a.parentNode.getAttribute("data-i")),highlightSAMmap(lastIndex,"currentMap"),document.querySelector("#treeIntroText").innerHTML=currentTaxonomyCountry+"   &nbsp; : &nbsp; "+numFamiliesList[currentTaxonomyCountry]+" families, "+numSpeciesList[currentTaxonomyCountry]+" species *"),taxPage.style.zIndex=5}}function closeAllFamilies(){for(var e=taxPage.querySelectorAll("#tree .familyOpen ul"),t=e.length,a=0;a<t;a++)e[a].classList.remove("open"),e[a].classList.add("closed"),e[a].parentNode.className="family";document.querySelector("#treeIntroText").innerHTML=currentTaxonomyCountry+"   &nbsp; : "+numFamiliesList[currentTaxonomyCountry]+" families, "+numSpeciesList[currentTaxonomyCountry]+" species *"}function deleteMap(){var e=this.parentNode;e.addEventListener("transitionend",e.parentNode.removeChild(this.parentNode),!1),e.classList.add("removed"),map.querySelector(".saveMapButton").style.display="block";var t=mapsCollection.children.length;0===t&&(mapsCollection.style.height="0",mapsCollection.style.margin="0")}function saveCurrentMap(){var e=mapsCollection.children.length;if(5!==e){var t=map.children[0],a=t.cloneNode(!0);a.classList.remove("birdMapInstance"),a.classList.add("thinify"),a.classList.add("smallBird"),a.querySelector(".birdName").classList.add("smallBirdText"),a.querySelector(".colorKey").style.opacity="0",a.querySelector(".colorKey").style.display="none",a.querySelector(".birdName").removeAttribute("id"),a.querySelector(".drawing").removeAttribute("id"),a.querySelector(".drawing").classList.add("smallBirdDrawing"),a.querySelector(".drawing").firstElementChild.setAttribute("id","thin"+currentID),a.removeAttribute("id"),0===e?(window.innerWidth>1680?mapsCollection.style.height="350px":window.innerWidth>=1600?mapsCollection.style.height="300px":window.innerWidth>=1165?mapsCollection.style.height="270px":mapsCollection.style.height="235px",mapsCollection.style.margin="30px 0 -35px 0"):e>=4&&(map.querySelector(".saveMapButton").style.display="none"),mapsCollection.appendChild(a),deleteMapButton=a.querySelector(".deleteMapButton"),deleteMapButton.addEventListener("click",deleteMap),document.getElementById("thin"+currentID).onload=function(){prepareSVGstyles("thin"+currentID),highlightSAMmap(lastIndex,"thin"+currentID),mapsCollection.lastChild.style.opacity="1",currentID++}}}var sampleTable,leftCheck,sciNames,italics,lineNumbers,showEndemics,currentChecklistCountry,currentChecklistCountryElement,checklistAuthorsPanel,countryModalOverlay,countryModalOpener,gNumDays,gStartDate,previousNumDaysClass,numDaysButton,checklistCountryButton,pdfButton,csvButton,taxonomyCountryButton,map;document.addEventListener("DOMContentLoaded",function(){map=document.getElementById("currentMap"),window.addEventListener("resize",onResizeWindow),countryModalOverlay=document.querySelector(".md-overlay"),countryModalOverlay.addEventListener("click",closeCountryModal),document.getElementById("countryModal").addEventListener("click",closeCountryModal),checklistCountryButton=document.getElementById("checklistCountryButton"),taxonomyCountryButton=document.getElementById("taxonomyCountryButton"),checklistCountryButton.addEventListener("click",showCountryModal),taxonomyCountryButton.addEventListener("click",showCountryModal),numDaysButton=document.getElementById("numDays"),numDaysButton.addEventListener("click",setNumDays),numDaysButton.children.item(11).classList.add("highlight"),gNumDays=10,sampleTable=document.getElementById("sampleTable"),sampleTable.classList.add("numDays"+String(gNumDays)),previousNumDaysClass="numDays"+String(gNumDays),pdfButton=document.getElementById("pdfButton"),pdfButton.addEventListener("click",openChecklistPage),csvButton=document.getElementById("csvButton"),csvButton.addEventListener("click",getCSVText),lineNumbers=document.getElementById("lineNumbers"),leftCheck=document.getElementById("leftCheck"),showEndemics=document.getElementById("showEndemics"),sciNames=document.getElementById("sciNames"),italics=document.getElementById("italics"),previousNumDaysClass="numDays10",lineNumbers.addEventListener("click",toggleSampleTableLineNumbers),leftCheck.addEventListener("click",toggleSampleTableLeftChecks),showEndemics.addEventListener("click",toggleSampleTableShowEndemics),sciNames.addEventListener("click",toggleSampleTableSciNames),italics.addEventListener("click",toggleSampleTableItalics),checklistAuthorsPanel=document.getElementById("checklistAuthorsPanel"),[].forEach.call(document.getElementsByClassName("country-menu")[0].getElementsByTagName("a"),function(e){e.addEventListener("click",choseCountry)}),toggleSampleTableLeftChecks(),leftCheck.checked=!0,window.innerWidth<870&&window.addEventListener("scroll",checkWindowScroll)});var countries={Argentina:0,Aruba:1,Bolivia:2,Brazil:3,Chile:4,Colombia:5,Curacao:6,Ecuador:7,FrenchGuiana:8,Guyana:9,Paraguay:10,Peru:11,Suriname:12,Trinidad:13,Uruguay:14,Venezuela:15,Bonaire:16,Falklands:17},endemicColor="#C23BC3",extinctColor="#ddd",residentColor="#3030cc",nonBreederColor="#ff9900",vagrantColor="#ffff00",hypotheticalColor="#33cc66",introducedColor="#111",baseColor="#545750",baseStrokeColor="#8a8b86",lastQuery,lastSpecies,species,families,numFamilies,birds=[],numSpeciesList={Argentina:999,Aruba:219,Bolivia:1381,Brazil:1799,Chile:475,Colombia:1846,"Curaçao":218,Ecuador:1620,"French Guiana":665,Guyana:783,Paraguay:694,Peru:1780,Suriname:724,Trinidad:468,Uruguay:444,Venezuela:1382,Bonaire:210,Falklands:227,Malvinas:227,"South America":3376},numFamiliesList={Argentina:87,Aruba:52,Bolivia:78,Brazil:91,Chile:65,Colombia:90,"Curaçao":50,Ecuador:91,"French Guiana":81,Guyana:78,Paraguay:72,Peru:88,Suriname:80,Trinidad:70,Uruguay:72,Venezuela:87,Bonaire:47,Falklands:48,Malvinas:48,"South America":102},currentTaxonomyCountry,currentTaxonomyCountryElement,taxonomyArticle,resultsFrag="",taxFragHTML="",taxPage,searchSpecials,searchResults,searchInput,lastResultsSpecies,lastIndex,searchSlideUpWrapper,searchSlideUpWrapper_height,taxInstructionsButton,searchInstructionsOpen=!0,selectedFillColor="#eee";document.addEventListener("DOMContentLoaded",function(){taxonomyArticle=document.getElementById("taxonomyArticle"),searchSlideUpWrapper=document.querySelector("#taxonomyArticle > div.slideUpWrapper"),searchSlideUpWrapper.style.height=searchSlideUpWrapper.clientHeight+"px",searchSlideUpWrapper_height=searchSlideUpWrapper.style.height,taxInstructionsButton=document.querySelector(".taxInstructionsButton"),searchInput=document.getElementById("searchInput"),searchSpecials=document.getElementById("searchSpecials"),searchInput.addEventListener("input",getQuery),searchInput.addEventListener("change",getQuery),searchInput.addEventListener("click",getQuery),searchInput.addEventListener("textInput",getQuery),searchInput.addEventListener("focusin",getQuery),searchInput.addEventListener("input",clearSearchInput),searchInput.addEventListener("change",clearSearchInput),searchInput.addEventListener("click",clearSearchInput),searchInput.addEventListener("textInput",clearSearchInput),searchInput.addEventListener("keyup",clearSearchInput),searchInput.addEventListener("focusin",clearSearchInput),searchSpecials.addEventListener("click",getSearchSpecialsQuery),taxInstructionsButton.addEventListener("click",showSearchInstructions),taxInstructionsButton.addEventListener("mouseover",function(){searchSlideUpWrapper.classList.add("hovering")}),taxInstructionsButton.addEventListener("mouseout",function(){searchSlideUpWrapper.classList.remove("hovering")}),createTaxPageHTML(),getAjax("../data/occurrences.txt",function(e){loadIntoArray(e)})});var deleteMapButton,saveMapButton,mapsCollection,currentID=0;document.addEventListener("DOMContentLoaded",function(){saveMapButton=document.querySelector(".saveMapButton"),saveMapButton.addEventListener("click",saveCurrentMap),mapsCollection=document.querySelector("#mapsCollection")});