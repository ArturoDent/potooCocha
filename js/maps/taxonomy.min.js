"use strict";function loadIntoArray(e){birds=e.split("\n")}function animateScrollTop(e){var t=25;!function a(){e.scrollTop-=t,e.scrollTop>0&&setTimeout(a,25)}()}function getAjax(e,t){var a=new XMLHttpRequest;return a.open("GET",e),a.onreadystatechange=function(){a.readyState>3&&200===a.status&&t(a.responseText)},a.setRequestHeader("X-Requested-With","XMLHttpRequest"),a.send(),a}function showSearchInstructions(e){e!==!0&&searchInstructionsOpen?(searchSlideUpWrapper.style.height=0,searchSlideUpWrapper.classList.add("closeInstructions"),taxInstructionsButton.classList.add("instructionsClosed"),searchInstructionsOpen=!1,document.querySelector(".taxInstructionsButton .tooltip").innerHTML="Open the search instructions"):(searchSlideUpWrapper.style.height=searchSlideUpWrapper_height,searchSlideUpWrapper.classList.remove("closeInstructions"),taxInstructionsButton.classList.remove("instructionsClosed"),searchInstructionsOpen=!0,document.querySelector(".taxInstructionsButton .tooltip").innerHTML="Close the search instructions")}function createTaxPageHTML(){resultsFrag="<div class='panel results-panel'>",resultsFrag+="  <div id='countrySearch' class='closed'>",resultsFrag+="    <span id='searchTerm'></span>",resultsFrag+="  </div>",resultsFrag+="  <ul id='searchResults' contenteditable='false'><li> &nbsp; &nbsp; search results will appear here...</li><li></li><li></li></ul>",resultsFrag+="</div>",taxFragHTML="<article id='taxTreeArticle'>",taxFragHTML+="  <div id='treeIntroText'>&nbsp; numFamilies Families, numSpecies species</div>",taxFragHTML+="  <div id='taxPage' class='panel' contenteditable='false'></div>",taxFragHTML+="  <div id='taxPageButtons'>Close all families</div>",taxFragHTML+="</article>"}function loadCountryTaxonomy(e){window.closeCountryModal(),document.getElementById("taxPage")||(taxonomyArticle.insertAdjacentHTML("beforeend",resultsFrag),mapsCollection.insertAdjacentHTML("afterend",taxFragHTML),taxPage=document.getElementById("taxPage"),searchResults=document.getElementById("searchResults"),taxPage.addEventListener("click",toggleFamilyOpen),searchResults.addEventListener("click",gotoMatch),document.querySelector("#searchForm span").classList.remove("grayed"),searchSpecials.classList.remove("grayed"));var t="string"==typeof e?e:e.target.innerHTML;if(currentTaxonomyCountry&&(currentTaxonomyCountryElement.classList.remove("taxHighlight"),currentTaxonomyCountryElement.classList.remove("bothHighlights")),lastQuery&&(document.getElementById("countrySearch").classList.remove("closed"),document.getElementById("searchTerm").innerHTML=t+" : '"+lastQuery,document.querySelector(".results-panel").style.opacity="1"),"French Guiana"===t?(getAjax("Countries/FrenchGuianaSACC.html",updatetaxArticleQueries),searchResults.classList.remove("samTax"),taxPage.classList.remove("samTax")):"Curaçao"===t?(getAjax("Countries/CuracaoSACC.html",updatetaxArticleQueries),searchResults.classList.remove("samTax"),taxPage.classList.remove("samTax")):"South America"===t?(getAjax("Countries/SouthAmericaSACC.html",updatetaxArticleQueries),searchResults.classList.add("samTax"),searchSpecials.querySelector("span:nth-of-type(3)").classList.add("notAvailable"),searchSpecials.querySelector("span:nth-of-type(5)").classList.add("notAvailable"),searchSpecials.classList.add("SAM"),taxPage.classList.add("samTax")):"Falklands/Malv."===t?(getAjax("Countries/FalklandsSACC.html",updatetaxArticleQueries),searchResults.classList.remove("samTax"),taxPage.classList.remove("samTax"),t="Falklands"):t&&(getAjax("Countries/"+t+"SACC.html",updatetaxArticleQueries),searchResults.classList.remove("samTax"),taxPage.classList.remove("samTax")),"South America"===currentTaxonomyCountry&&"South America"!==t&&(searchSpecials.querySelector("span:nth-of-type(3)").classList.remove("notAvailable"),searchSpecials.querySelector("span:nth-of-type(5)").classList.remove("notAvailable"),searchSpecials.classList.remove("SAM")),lastQuery)"endemic"!==lastQuery&&"hypothetical"!==lastQuery&&"vagrant"!==lastQuery&&"incertae"!==lastQuery&&"extinct"!==lastQuery||(currentMap.querySelector(".saveMapButton").style.display="none",selectedCountryFillColor(t.replace(" ",""),selectedFillColor));else{currentMap.querySelector(".saveMapButton").style.display="none";var a=t.replace(" ","");selectedCountryFillColor(a,selectedFillColor)}currentTaxonomyCountry=t,taxonomyCountryButton.innerHTML=t,"Falklands"===t&&(taxonomyCountryButton.innerHTML="Malvinas"),currentTaxonomyCountryElement=e.target,currentTaxonomyCountryElement.classList.add("taxHighlight"),currentTaxonomyCountryElement.classList.contains("checkHighlight")&&currentTaxonomyCountryElement.classList.add("bothHighlights"),taxonomyCountryButton.classList.remove("needsAttention"),taxonomyCountryButton.classList.add("highlight"),document.querySelector("#treeIntroText").innerHTML=t+" &nbsp; : &nbsp; "+numFamiliesList[t]+" families, "+numSpeciesList[t]+" species *","Falklands"===t&&(document.querySelector("#treeIntroText").innerHTML="Falklands/Malvinas &nbsp; : &nbsp; "+numFamiliesList[t]+" families, "+numSpeciesList[t]+" species *"),document.querySelector(".colorKey").style.opacity="0.9",animateScrollTop(taxPage)}function updatetaxArticleQueries(e){taxPage.innerHTML=e,species=document.getElementById("tree").getElementsByTagName("li"),families=taxPage.querySelectorAll("#tree .familyOpen, #tree .family"),numFamilies=families.length,lastQuery&&searchTree(lastQuery),document.querySelector("#taxPageButtons").addEventListener("click",closeAllFamilies)}function clearSearchInput(){searchInput.placeholder="",searchInput.removeEventListener("input",clearSearchInput),searchInput.removeEventListener("change",clearSearchInput),searchInput.removeEventListener("click",clearSearchInput),searchInput.removeEventListener("textInput",clearSearchInput),searchInput.removeEventListener("focusin",clearSearchInput)}function getQuery(e){var t=searchInput.value.search(/[^a-zñã'\s\*\?-]/i);if(t!==-1)return searchResults.innerHTML="<li></li><li> &nbsp; &nbsp; character '"+searchInput.value[t]+"' not allowed </li><li></li>",void(searchResults.style.height="55px");if(!(searchInput.value.length<2)){var a=e||window.event;return"textinput"===a.type?(searchTree(searchInput.value),a.preventDefault(),!1):void("input"===a.type?searchTree(searchInput.value):"onpropertychange"===a.type&&searchTree(searchInput.value))}}function getSearchSpecialsQuery(e){var t=e.target.textContent.split(" ")[0];searchTree(t)}function escapeRegExp(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function searchTree(e){var t;e=escapeRegExp(e),document.querySelector(".colorKey").style.opacity="0.9";var a=0,s=new MutationObserver(function(){searchResults.style.height="auto",searchResults.scrollHeight>=300?searchResults.style.height="300px":searchResults.style.height=searchResults.scrollHeight+"px"});if(s.observe(searchResults,{childList:!0}),!currentTaxonomyCountry)return void taxonomyCountryButton.classList.add("needsAttention");if(document.getElementById("searchResults").classList.remove("fadeIn"),document.querySelector(".results-panel").style.opacity="1",lastQuery=e,!lastQuery)return searchResults.innerHTML="<li></li><li> &nbsp; &nbsp; search results will appear here</li><li></li>",searchResults.classList.add("fadeIn"),void(searchResults.style.top=0);document.getElementById("countrySearch").classList.remove("closed"),"Falklands"===currentTaxonomyCountry?document.getElementById("searchTerm").innerHTML="Falklands/Malvinas : '"+lastQuery:document.getElementById("searchTerm").innerHTML=currentTaxonomyCountry+" : '"+lastQuery,animateScrollTop(searchResults);for(var n=0;n<numFamilies;n++)families[n].cloned=!1;var r=!1;lastSpecies&&lastSpecies.classList.contains("active")&&lastSpecies.classList.remove("active");var l,i,c=[],o=0,u=species.length;if("endemic"===e||"hypothetical"===e||"vagrant"===e||"incertae"===e||"extinct"===e){var p;"endemic"===e?p=document.getElementById("tree").getElementsByClassName("endemic"):"extinct"===e?p=document.getElementById("tree").getElementsByClassName("extinct"):"hypothetical"===e?p=document.getElementById("tree").getElementsByClassName("hy"):"vagrant"===e?p=document.getElementById("tree").getElementsByClassName("va"):"incertae"===e&&(p=document.getElementById("tree").getElementsByClassName("ince"));for(var d=0;d<p.length;d++)p[d].parentNode.parentNode.parentNode.cloned!==!0&&(c[o++]=p[d].parentNode.parentNode.parentNode.cloneNode(!0),p[d].parentNode.parentNode.parentNode.cloned=!0),c[o++]=p[d].parentNode.cloneNode(!0)}else{if(e=e.replace(/^\s+|\s+$/g,""),e=e.replace(/\\\*/g,"[a-zA-Z'ñã\\s-]+"),e=e.replace(/\\\?/g,"[a-zA-Z'ñã\\s-]"),e=e.replace(/n/g,"(n|ñ)"),e=e.replace(/a/g,"(a|ã)"),e=e.replace(/ú/g,"u"),e=e.replace(/á/g,"a"),e=e.replace(/ó/g,"o"),e=e.replace(/í/g,"i"),e=e.replace(/ç/g,"c"),e=e.replace(/\s+/g,"\\s+"),e?t=e:(t=searchInput.value.replace(/^\s+|\s+$/g,""),"type here"===t?r=!0:""===t&&(r=!0)),r)return searchResults.innerHTML="<li></li><li> &nbsp; &nbsp; no search term entered</li><li></li>",document.getElementById("searchResults").classList.add("fadeIn"),void(searchResults.style.height="55px");var m=new RegExp(t,"i");for(n=0;n<u;n++)if(l=species[n],i=l.className,l.firstChild.textContent.match(m)||l.childNodes[1].textContent.match(m)){"family"!==i&&"familyOpen"!==i||(l.cloned=!0);var h=l.parentNode.parentNode;"family"!==i&&"familyOpen"!==i&&h.cloned!==!0&&(c[o++]=h.cloneNode(!0),h.cloned=!0),c[o++]=l.cloneNode(!0)}}if(0===c.length)return searchResults.innerHTML="<li></li><li> &nbsp; &nbsp; no matching results found</li><li></li>",document.getElementById("searchResults").classList.add("fadeIn"),void(searchResults.style.height="55px");var y,g,x="";for(d=0;d<c.length;d++)if(g=c[d].className,"family"===g||"familyOpen"===g){if(x+="<li class='family'><span class='fco'>",x+=c[d].firstChild.textContent+"</span><span class='fsc'>",x+=c[d].childNodes[1].firstChild?c[d].childNodes[1].firstChild.nodeValue:" ",x+="</span></li>",1===c.length){for(y=0;y<c[0].children[2].children.length;y++)x+="<li>"+c[0].children[2].children[y].innerHTML+"</li>";a=y}}else"fsc"===g||(c[d].style.textShadow="none",x+="<li data-i='"+c[d].getAttribute("data-i")+"' class='bird'>"+c[d].innerHTML+"</li>",a++);searchResults.innerHTML=x,document.getElementById("searchResults").classList.add("fadeIn"),lastQuery=lastQuery.replace(/\\\*/g,"*"),lastQuery=lastQuery.replace(/\\\?/g,"?"),"Falklands"===currentTaxonomyCountry?document.getElementById("searchTerm").innerHTML="Malvinas/Falklands : '"+lastQuery+"'&nbsp;&nbsp;&nbsp;   [ "+a+" species ]":document.getElementById("searchTerm").innerHTML=currentTaxonomyCountry+" : '"+lastQuery+"'&nbsp;&nbsp;&nbsp;   [ "+a+" species ]"}function gotoMatch(e){currentMap.querySelector(".colorKey").style.opacity="0.9",lastSpecies&&lastSpecies.classList.contains("active")&&lastSpecies.classList.remove("active");var t=e||window.event,a=t.target,s=a.parentNode,n=a.className;if("no matching results found"!==a.textContent.replace(/^\s+|\s+$/g,"")&&"no search term entered"!==a.textContent.replace(/^\s+|\s+$/g,"")&&"search results will appear here"!==a.textContent.replace(/^\s+|\s+$/g,"")&&""!==a.textContent.replace(/^\s+|\s+$/g,"")){a="family"===n?t.target:"fco"===n?s:"fsc"===n?s:null!==n.match(/co/)?s:"bird"===n?t.target:s;for(var r,l=species.length,i=a.textContent,c=0;c<l;c++){if(r=species[c],r.textContent===i){var o=r.parentNode;o.classList.contains("open")||(o.classList.add("open"),o.parentNode.className="familyOpen"),taxPage.scrollTop=o.parentNode.offsetTop+r.offsetTop-100,r.className="active",lastSpecies=r,lastIndex=Number(r.getAttribute("data-i")),highlightSAMmap(lastIndex,"currentMap"),lastResultsSpecies&&lastResultsSpecies.classList.toggle("active"),a.classList.toggle("active"),lastResultsSpecies=a,addBirdNameToMap(r);break}if(r.firstChild.textContent+r.firstChild.nextSibling.textContent===i||i===r.firstChild.textContent+" "){var u=r.children[2];u.classList.contains("closed")&&(u.classList.add("open"),u.parentNode.className="familyOpen"),taxPage.scrollTop=r.offsetTop-10,lastSpecies=u,lastResultsSpecies&&(lastResultsSpecies.classList.toggle("active"),lastResultsSpecies=null);break}}}}function addBirdNameToMap(e){var t="";e?(t="<span>"+e.firstChild.textContent+"</span><br/><span>"+e.lastChild.textContent+"</span>",document.getElementById("currentBirdName").innerHTML=t):document.getElementById("currentBirdName").innerHTML=t}function toggleFamilyOpen(e){if(e.stopPropagation(),numFamilies){document.querySelector(".colorKey").style.opacity="0.9",e=e||window.event;var t,a=e.target,s=a.className;if("family"===s||"familyOpen"===s?t=e.target.firstChild.nextSibling.nextSibling.nextSibling:"fco"===s?t=e.target.nextSibling.nextSibling.nextSibling:"fsc"===s&&(t=e.target.nextSibling.nextSibling),t&&!t.classList.contains("open")){t.classList.add("open"),t.parentNode.className="familyOpen";var n=taxPage.getBoundingClientRect().height;t.offsetTop-taxPage.scrollTop>n-24&&(t.parentNode.clientHeight>n?taxPage.scrollTop=t.parentNode.offsetTop:taxPage.scrollTop+=t.lastElementChild.offsetTop+t.lastElementChild.clientHeight),document.querySelector("#treeIntroText").innerHTML=currentTaxonomyCountry+"  &nbsp; : &nbsp; "+t.parentNode.children[1].textContent+" has "+t.children.length+" species"}else if(t){t.classList.remove("open"),t.parentNode.className="family";var r=t.parentNode.querySelectorAll(".active");r.length&&(r[0].className=""),document.querySelector("#treeIntroText").innerHTML=currentTaxonomyCountry+"   &nbsp; : &nbsp; "+numFamiliesList[currentTaxonomyCountry]+" families, "+numSpeciesList[currentTaxonomyCountry]+" species"}t||(a.parentNode.classList.contains("birds")&&(a=a.firstChild),a.parentNode.className="active",lastSpecies&&lastSpecies.classList.contains("active")&&lastSpecies.classList.remove("active"),lastSpecies=a.parentNode,lastResultsSpecies&&lastResultsSpecies.classList.toggle("active"),lastResultsSpecies=null,addBirdNameToMap(a.parentNode),lastIndex=Number(a.parentNode.getAttribute("data-i")),highlightSAMmap(lastIndex,"currentMap"),document.querySelector("#treeIntroText").innerHTML=currentTaxonomyCountry+"   &nbsp; : &nbsp; "+numFamiliesList[currentTaxonomyCountry]+" families, "+numSpeciesList[currentTaxonomyCountry]+" species *")}}function closeAllFamilies(){for(var e=taxPage.querySelectorAll("#tree .familyOpen ul"),t=e.length,a=0;a<t;a++)e[a].classList.remove("open"),e[a].classList.add("closed"),e[a].parentNode.className="family";document.querySelector("#treeIntroText").innerHTML=currentTaxonomyCountry+"   &nbsp; : "+numFamiliesList[currentTaxonomyCountry]+" families, "+numSpeciesList[currentTaxonomyCountry]+" species *"}var lastQuery,lastSpecies,species,families,numFamilies,birds=[],numSpeciesList={Argentina:999,Aruba:216,Bolivia:1381,Brazil:1799,Chile:475,Colombia:1838,"Curaçao":218,Ecuador:1620,"French Guiana":665,Guyana:783,Paraguay:694,Peru:1780,Suriname:724,Trinidad:468,Uruguay:444,Venezuela:1382,Bonaire:210,Falklands:227,Malvinas:227,"South America":3371},numFamiliesList={Argentina:87,Aruba:50,Bolivia:78,Brazil:91,Chile:65,Colombia:90,"Curaçao":50,Ecuador:91,"French Guiana":81,Guyana:78,Paraguay:72,Peru:88,Suriname:80,Trinidad:70,Uruguay:72,Venezuela:87,Bonaire:47,Falklands:48,Malvinas:48,"South America":102},currentTaxonomyCountry,currentTaxonomyCountryElement,taxonomyArticle,resultsFrag="",taxFragHTML="",taxPage,searchSpecials,searchResults,searchInput,lastResultsSpecies,lastIndex,searchSlideUpWrapper,searchSlideUpWrapper_height,taxInstructionsButton,searchInstructionsOpen=!0,selectedFillColor="#eee";document.addEventListener("DOMContentLoaded",function(){taxonomyArticle=document.getElementById("taxonomyArticle"),searchSlideUpWrapper=document.querySelector("#taxonomyArticle > div.slideUpWrapper"),searchSlideUpWrapper.style.height=searchSlideUpWrapper.clientHeight+"px",searchSlideUpWrapper_height=searchSlideUpWrapper.style.height,taxInstructionsButton=document.querySelector(".taxInstructionsButton"),searchInput=document.getElementById("searchInput"),searchSpecials=document.getElementById("searchSpecials"),searchInput.addEventListener("input",getQuery),searchInput.addEventListener("change",getQuery),searchInput.addEventListener("click",getQuery),searchInput.addEventListener("textInput",getQuery),searchInput.addEventListener("focusin",getQuery),searchInput.addEventListener("input",clearSearchInput),searchInput.addEventListener("change",clearSearchInput),searchInput.addEventListener("click",clearSearchInput),searchInput.addEventListener("textInput",clearSearchInput),searchInput.addEventListener("keyup",clearSearchInput),searchInput.addEventListener("focusin",clearSearchInput),searchSpecials.addEventListener("click",getSearchSpecialsQuery),taxInstructionsButton.addEventListener("click",showSearchInstructions),taxInstructionsButton.addEventListener("mouseover",function(){searchSlideUpWrapper.classList.add("hovering")}),taxInstructionsButton.addEventListener("mouseout",function(){searchSlideUpWrapper.classList.remove("hovering")}),createTaxPageHTML(),getAjax("../data/occurrences.txt",function(e){loadIntoArray(e)})});
//# sourceMappingURL=js/sourceMaps/taxonomy.min.js.map
