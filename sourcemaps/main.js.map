{"version":3,"names":[],"mappings":"","sources":["main.js"],"sourcesContent":["\"use strict\";\r\n\r\nvar sampleTable;\r\nvar leftCheck;\r\nvar sciNames;\r\nvar italics;\r\nvar lineNumbers;\r\nvar showEndemics;\r\n\r\n// var birds;\r\n\r\n//#region\r\n\r\nvar currentChecklistCountry;\r\nvar currentChecklistCountryElement;\r\nvar checklistAuthorsPanel;\r\n\r\n//#endregion\r\n\r\nvar countryModalOverlay;\r\nvar countryModalOpener;\r\nvar countryModal;\r\n\r\nvar gNumDays;\r\nvar gStartDate;\r\nvar previousNumDaysClass;\r\n\r\nvar numDaysButton;\r\nvar checklistCountryButton;\r\nvar pdfButton;\r\nvar csvButton;\r\nvar taxonomyCountryButton;\r\n\r\n// var map;\r\n\r\n/* global  map  loadCountryTaxonomy  selectedCountryFillColor getAjax currentMap selectedFillColor fillSAMmap  */\r\n\r\ndocument.addEventListener(\"DOMContentLoaded\", function () {\r\n  console.log(\"window.width = \" + window.innerWidth);\r\n  // map   =  document.getElementById(\"currentMap\");\r\n\r\n  window.addEventListener(\"resize\", onResizeWindow);\r\n\r\n  countryModalOverlay = document.querySelector(\".md-overlay\");\r\n\r\n  countryModalOverlay.addEventListener(\"click\", closeCountryModal);\r\n\r\n  // document.getElementById(\"countryModal\").addEventListener(\"click\", closeCountryModal);\r\n\r\n  checklistCountryButton                   =  document.getElementById(\"checklistCountryButton\");\r\n  taxonomyCountryButton                    =  document.getElementById(\"taxonomyCountryButton\");\r\n\r\n  checklistCountryButton.addEventListener(\"click\", showCountryModal);\r\n  taxonomyCountryButton.addEventListener(\"click\", showCountryModal);\r\n\r\n  numDaysButton                       =  document.getElementById(\"numDays\");\r\n  numDaysButton.addEventListener(\"click\", setNumDays);\r\n\r\n  numDaysButton.children.item(11).classList.add(\"highlight\");\r\n  gNumDays = 10;\r\n\r\n  sampleTable = document.getElementById(\"sampleTable\");\r\n  sampleTable.classList.add(\"numDays\" + String(gNumDays));\r\n\r\n  previousNumDaysClass = \"numDays\" + String(gNumDays);\r\n\r\n  pdfButton                           =  document.getElementById(\"pdfButton\");\r\n  pdfButton.addEventListener(\"click\", openChecklistPage);\r\n\r\n  csvButton                           =  document.getElementById(\"csvButton\");\r\n  csvButton.addEventListener(\"click\", getCSVText);\r\n\r\n  lineNumbers  =  document.getElementById(\"lineNumbers\");\r\n  leftCheck    =  document.getElementById(\"leftCheck\");\r\n  showEndemics =  document.getElementById(\"showEndemics\");\r\n  sciNames     =  document.getElementById(\"sciNames\");\r\n  italics      =  document.getElementById(\"italics\");\r\n\r\n  previousNumDaysClass = \"numDays10\";\r\n\r\n  lineNumbers.addEventListener(\"click\", toggleSampleTableLineNumbers);\r\n  leftCheck.addEventListener(\"click\", toggleSampleTableLeftChecks);\r\n  showEndemics.addEventListener(\"click\", toggleSampleTableShowEndemics);\r\n  sciNames.addEventListener(\"click\", toggleSampleTableSciNames);\r\n  italics.addEventListener(\"click\", toggleSampleTableItalics);\r\n\r\n  checklistAuthorsPanel = document.getElementById(\"checklistAuthorsPanel\");\r\n\r\n  //  TODO : (below should be changed)\r\n\r\n  [].forEach.call(document.getElementsByClassName(\"country-menu\")[0].getElementsByTagName(\"a\"), function (el) {\r\n    el.addEventListener(\"click\", choseCountry);\r\n  });\r\n\r\n  // toggleSampleTableLeftChecks();\r\n  leftCheck.checked = true;\r\n\r\n  countryModal = document.getElementById(\"countryModal\");\r\n\r\n  // only set for smaller widths, here and in onResizeWindow()\r\n  if (window.innerWidth < 870) { window.addEventListener(\"scroll\", checkWindowScroll); }\r\n});\r\n\r\n//   *******************  end of  (document).ready(function() ******************************************\r\n\r\nfunction onResizeWindow() {\r\n  // console.log(\"onResize() called\");\r\n\r\n  // initCurrentMap();\r\n\r\n  if (window.innerWidth < 870) { window.addEventListener(\"scroll\", checkWindowScroll); }\r\n  else window.removeEventListener(\"scroll\", checkWindowScroll);\r\n\r\n  // check for mapCollection height\r\n  var mapsCollection = document.querySelector(\"#mapsCollection\");\r\n\r\n  var len = mapsCollection.children.length;\r\n\r\n  if (len > 0) {\r\n\r\n    if (window.innerWidth > 1680) mapsCollection.style.height = \"350px\";\r\n    else if (window.innerWidth >= 1600) mapsCollection.style.height = \"300px\";\r\n    else if (window.innerWidth >= 1165) mapsCollection.style.height = \"270px\";\r\n    else mapsCollection.style.height = \"235px\";\r\n  }\r\n\r\n  console.log(\"Resize: window.width = \" + window.innerWidth);\r\n}\r\n\r\nfunction checkWindowScroll() {\r\n\r\n  var docElement = document.documentElement;\r\n  var winElement = window;\r\n\r\n  if ((docElement.scrollHeight - winElement.innerHeight) <= winElement.pageYOffset) {\r\n    document.getElementById(\"currentMap\").style.opacity = 0;\r\n  }\r\n  else document.getElementById(\"currentMap\").style.opacity = 1;\r\n}\r\n\r\nfunction showCountryModal(evt) {\r\n\r\n  countryModal.classList.add(\"menu-show\");\r\n  countryModal.classList.add(\"md-show\");\r\n\r\n  if (evt.target.id === \"checklistCountryButton\") countryModalOpener = \"checklistCountryButton\";\r\n  else countryModalOpener = \"taxonomyCountryButton\";\r\n}\r\n\r\nfunction closeCountryModal(evt)  {\r\n\r\n  countryModal.classList.remove(\"menu-show\");\r\n  countryModal.classList.remove(\"md-show\");\r\n\r\n  if (evt) evt.stopPropagation();\r\n}\r\n\r\nfunction toggleSampleTableShowEndemics() {\r\n\r\n  sampleTable.querySelector(\"td.endemical\").classList.toggle(\"showEndemics\");\r\n}\r\n\r\nfunction toggleSampleTableSciNames()  {\r\n\r\n  sampleTable.classList.toggle(\"noScientificNames\");\r\n  italics.disabled = !italics.disabled;\r\n}\r\n\r\nfunction toggleSampleTableItalics()  {\r\n\r\n  sampleTable.classList.toggle(\"noItalics\");\r\n}\r\n\r\n// add : if no sci names = both line numbers and endemic possible ?\r\n\r\nfunction toggleSampleTableLeftChecks() {\r\n\r\n  [].forEach.call(sampleTable.getElementsByClassName(\"leftCheckBox\"), function (el) {\r\n    el.classList.toggle(\"show\");\r\n  });\r\n\r\n  [].forEach.call(sampleTable.getElementsByClassName(\"familyHidden\"), function (el) {\r\n    el.classList.toggle(\"show\");\r\n  });\r\n}\r\n\r\nfunction toggleSampleTableLineNumbers() {\r\n\r\n  sampleTable.querySelector(\"td.lineNumbers\").classList.toggle(\"showLineNumbers\");\r\n}\r\n\r\n// decide which function to call based on which countryButton opened the country menu\r\nfunction choseCountry(evt) {\r\n\r\n  // if (!currentChecklistCountry && !parseInt) map.getElementsByClassName(\"drawing\")[0].classList.add(\"active\");\r\n  if (!currentChecklistCountry) map.getElementsByClassName(\"drawing\")[0].classList.add(\"active\");\r\n\r\n  if (countryModalOpener === \"checklistCountryButton\") choseChecklistCountry(evt);\r\n  else loadCountryTaxonomy(evt);\r\n}\r\n\r\nfunction choseChecklistCountry(evt) {\r\n\r\n  var selectedCountry;\r\n\r\n  var pageScrollTop = document.body.scrollTop;\r\n\r\n  closeCountryModal();\r\n\r\n  if (currentChecklistCountry) {\r\n    currentChecklistCountryElement.classList.remove(\"checkHighlight\");\r\n    currentChecklistCountryElement.classList.remove(\"bothHighlights\");\r\n  }\r\n\r\n  selectedCountry = evt.target.innerText;\r\n\r\n  if (evt.target.tagName === \"A\") {\r\n    currentChecklistCountryElement = evt.target;\r\n    // selectedCountry = evt.target.children[1].innerHTML;\r\n  }\r\n  else if (evt.target.tagName === \"SPAN\") {\r\n    currentChecklistCountryElement = evt.target.parentNode;\r\n    // selectedCountry = evt.target.innerHTML;\r\n  }\r\n  // else {  //  evt.target.tagName === \"IMG\")\r\n  //   currentChecklistCountryElement = evt.target.parentNode;\r\n  //   selectedCountry = evt.target.nextElementSibling.innerHTML;\r\n  // }\r\n\r\n  if (selectedCountry === \"South America\")  currentChecklistCountry = \"SouthAmerica\";\r\n  else if (selectedCountry === \"French Guiana\")  currentChecklistCountry = \"FrenchGuiana\";\r\n  // else if (selectedCountry === \"Falklands/Malv.\")  currentChecklistCountry = \"Falklands\";\r\n  // else if (selectedCountry === \"Malvinas\")  currentChecklistCountry = \"Falklands\";\r\n  else if (selectedCountry === \"CuraÃ§ao\")  currentChecklistCountry = \"Curacao\";\r\n  else   currentChecklistCountry = selectedCountry;\r\n\r\n  checklistCountryButton.innerHTML = selectedCountry;\r\n  // if (selectedCountry === \"Falklands/Malv.\") checklistCountryButton.innerHTML = \"Falklands\";\r\n\r\n  currentChecklistCountryElement.classList.add(\"checkHighlight\");\r\n  if (currentChecklistCountryElement.classList.contains(\"taxHighlight\")) currentChecklistCountryElement.classList.add(\"bothHighlights\");\r\n\r\n  checklistCountryButton.classList.remove(\"needsAttention\");\r\n  checklistCountryButton.classList.add(\"highlight\");\r\n\r\n  pdfButton.classList.add(\"highlight\");\r\n  csvButton.classList.add(\"highlight\");\r\n\r\n  document.body.scrollTop = pageScrollTop;\r\n\r\n  currentMap.querySelector(\".saveMapButton\").style.display = \"none\";\r\n  currentMap.querySelector(\".colorKey\").style.opacity = \"0\";\r\n\r\n  if (selectedCountry !== \"South America\") selectedCountryFillColor(currentChecklistCountry, selectedFillColor);\r\n  else fillSAMmap(\"\", \"\");\r\n\r\n  getAjax(\"Authors/\" + currentChecklistCountry + \".txt\", setChecklistAuthors);\r\n}\r\n\r\n// ^(.*\\\\.) \\\\d\\\\d\\\\d\\\\d\\\\..*(Version.*$)\r\nfunction setChecklistAuthors(data) {\r\n\r\n  if (currentChecklistCountry === \"SouthAmerica\") {\r\n    checklistAuthorsPanel.innerHTML = \"&nbsp;&nbsp;c<a href='citations.html' target='_blank'>itation</a>s&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\";\r\n\r\n    checklistAuthorsPanel.classList.add(\"show\");\r\n    return;\r\n  }\r\n\r\n  var authors = data.replace(/^(.*\\.) \\d\\d\\d\\d\\..*Version(.*$)/g, \"$1 $2\");\r\n  checklistAuthorsPanel.innerHTML = authors;\r\n\r\n  checklistAuthorsPanel.classList.add(\"show\");\r\n}\r\n\r\nfunction setNumDays(evt)  {\r\n\r\n  var day = evt.target;\r\n\r\n  if (day.classList.contains(\"highlight\")) {  // if click on already highlighted target ignore\r\n    return;\r\n  }\r\n  else if (gNumDays || gNumDays === 0)   {\r\n    numDaysButton.children[gNumDays+1].classList.remove(\"highlight\");\r\n  }\r\n\r\n  day.classList.add(\"highlight\");\r\n  gNumDays = parseInt(day.innerHTML);\r\n\r\n  sampleTable.classList.remove(previousNumDaysClass);\r\n  sampleTable.classList.add(\"numDays\" + String(gNumDays));\r\n\r\n  previousNumDaysClass = \"numDays\" + String(gNumDays);\r\n\r\n  // rules for column double border right vs. number of days\r\n\r\n  // clear all cds classes\r\n\r\n  [].forEach.call(sampleTable.querySelectorAll(\"td\"), function (el) {\r\n    el.classList.remove(\"cds\");\r\n  });\r\n\r\n  [].forEach.call(sampleTable.querySelectorAll(\"th\"), function (el) {\r\n    el.classList.remove(\"cds\");\r\n  });\r\n\r\n  // [].forEach.call(sampleTable.querySelectorAll(\"td:nth-child(6)\"), function (el) {\r\n  //   el.classList.remove(\"cds\");\r\n  // });\r\n\r\n  // sampleTable.querySelector(\"th:nth-child(4)\").classList.remove(\"cds\");\r\n\r\n  // [].forEach.call(sampleTable.querySelectorAll(\"td:nth-child(8)\"), function (el) {\r\n  //   el.classList.remove(\"cds\");\r\n  // });\r\n\r\n  // sampleTable.querySelector(\"th:nth-child(6)\").classList.remove(\"cds\");\r\n\r\n  if (gNumDays === 6) {\r\n\r\n    [].forEach.call(sampleTable.querySelectorAll(\"td:nth-child(6)\"), function (el) {\r\n      el.classList.add(\"cds\");\r\n    });\r\n\r\n    sampleTable.querySelector(\"th:nth-child(4)\").classList.add(\"cds\");\r\n  }\r\n  else if (gNumDays ===  7 || gNumDays === 8) {\r\n\r\n    [].forEach.call(sampleTable.querySelectorAll(\"td:nth-child(7)\"), function (el) {\r\n      el.classList.add(\"cds\");\r\n    });\r\n\r\n    sampleTable.querySelector(\"th:nth-child(5)\").classList.add(\"cds\");\r\n  }\r\n  else if (gNumDays ===  9 || gNumDays === 10) {\r\n\r\n    [].forEach.call(sampleTable.querySelectorAll(\"td:nth-child(8)\"), function (el) {\r\n      el.classList.add(\"cds\");\r\n    });\r\n\r\n    sampleTable.querySelector(\"th:nth-child(6)\").classList.add(\"cds\");\r\n  }\r\n  else if (gNumDays === 11 || gNumDays === 12) {\r\n\r\n    [].forEach.call(sampleTable.querySelectorAll(\"td:nth-child(8)\"), function (el) {\r\n      el.classList.add(\"cds\");\r\n    });\r\n\r\n    sampleTable.querySelector(\"th:nth-child(6)\").classList.add(\"cds\");\r\n\r\n    [].forEach.call(sampleTable.querySelectorAll(\"td:nth-child(13)\"), function (el) {\r\n      el.classList.add(\"cds\");\r\n    });\r\n\r\n    sampleTable.querySelector(\"th:nth-child(11)\").classList.add(\"cds\");\r\n  }\r\n\r\n  if (gNumDays !== 0) {\r\n\r\n    [].forEach.call(sampleTable.getElementsByTagName(\"th\"), function (el) {\r\n      el.classList.remove(\"flashDays\");\r\n    });\r\n\r\n    sampleTable.querySelector(\"th:nth-child(\" + (gNumDays + 1) + \")\").classList.add(\"flashDays\");\r\n  }\r\n}\r\n\r\nfunction getCSVText()  {\r\n\r\n  if (currentChecklistCountry)  {\r\n\r\n    // var form = $('<form method=\"post\" action=\"../php/sendCSV.php?country=' + currentChecklistCountry + '\"></form>');\r\n    var form = document.createElement(\"form\");\r\n    form.setAttribute(\"method\", \"post\");\r\n    form.setAttribute(\"action\", \"../php/sendCSV.php?country=\" + currentChecklistCountry + \"\");\r\n\r\n    document.body.appendChild(form);\r\n\r\n    form.submit();\r\n    form.remove();\r\n  }\r\n  else  checklistCountryButton.classList.add(\"needsAttention\");\r\n}\r\n\r\nfunction openChecklistPage()  {\r\n\r\n  var vars;\r\n\r\n  if (!currentChecklistCountry)  {\r\n    checklistCountryButton.innerHTML = \"Select Country\";\r\n    checklistCountryButton.classList.add(\"needsAttention\");\r\n    return;\r\n  }\r\n\r\n  if (gNumDays === undefined)   gNumDays = 12;\r\n  if (gStartDate === undefined) gStartDate = 1;\r\n\r\n  vars = \"?country=\"       + currentChecklistCountry;\r\n  vars += \"&num_days=\"     + gNumDays;\r\n  vars += \"&start_date=\"   + gStartDate;\r\n\r\n  vars += \"&line_nos=\"     + lineNumbers.checked;\r\n  vars += \"&left_check=\"   + leftCheck.checked;\r\n  vars += \"&endemics=\"     + showEndemics.checked;\r\n  vars += \"&sci_names=\"    + !sciNames.checked;\r\n  vars += \"&italics=\"      + !italics.checked;\r\n\r\n  window.open( \"../php/makePDF.php\" + vars, \"_blank\" );\r\n}"],"file":"../main.js"}